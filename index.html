<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cryptinity Web4 | The Safe Zone</title>
    
    <!-- Sci-Fi Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Firebase SDK -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import { getFirestore } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyALkLkbBr2SCxLyon970oyoBr2hmfFu0kE",
        authDomain: "cryptinity--ultra--web4.firebaseapp.com",
        projectId: "cryptinity--ultra--web4",
        storageBucket: "cryptinity--ultra--web4.firebasestorage.app",
        messagingSenderId: "624069180316",
        appId: "1:624069180316:web:124ddb51d9194fe539a659"
      };

      const app = initializeApp(firebaseConfig);
      console.log("Cryptinity Web4 Network: SECURE");
    </script>

    <style>
        :root {
            --bg-dark: #0d0d0d;
            --bg-panel: #1e251f;
            --neon-green: #9bf364;
            --neon-teal: #4ed5d2;
            --dark-green: #0e6011;
            --text-main: #ffffff;
            --text-muted: #aabaac;
            --glass: rgba(30, 37, 31, 0.85);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
        }

        /* Typography */
        h1, h2, h3, .orbitron { font-family: 'Orbitron', sans-serif; text-transform: uppercase; }

        /* --- AUDIO START OVERLAY --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            cursor: pointer;
        }
        .start-btn {
            border: 2px solid var(--neon-green); color: var(--neon-green);
            padding: 20px 40px; font-family: 'Orbitron'; font-size: 1.5rem;
            background: rgba(0,0,0,0.8); letter-spacing: 3px;
            animation: pulseBtn 1.5s infinite;
            text-transform: uppercase;
        }
        @keyframes pulseBtn {
            0% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(155, 243, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0); }
        }

        /* --- CINEMATIC INTRO --- */
        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: none; /* Hidden initially, shown by JS */
            justify-content: center; align-items: center; flex-direction: column;
            pointer-events: none;
        }
        .intro-active {
            display: flex !important;
            animation: fadeOut 2s ease-in-out 3s forwards;
        }
        #intro-logo {
            width: 250px; opacity: 0;
            animation: logoReveal 2s ease-out 0.5s forwards;
            filter: drop-shadow(0 0 30px var(--neon-green));
        }
        #intro-text {
            margin-top: 20px; font-size: 2rem; color: var(--neon-teal);
            letter-spacing: 5px; opacity: 0; font-family: 'Orbitron';
            animation: textReveal 1s ease-out 1.5s forwards;
        }
        @keyframes logoReveal { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes textReveal { 0% { letter-spacing: 15px; opacity: 0; } 100% { letter-spacing: 5px; opacity: 1; } }
        @keyframes fadeOut { 0% { opacity: 1; } 100% { opacity: 0; pointer-events: none; } }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; width: 100%; padding: 10px 20px;
            background: rgba(13, 13, 13, 0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--dark-green); z-index: 100;
            box-shadow: 0 0 20px rgba(14, 96, 17, 0.3);
        }
        .brand { display: flex; align-items: center; gap: 10px; }
        .brand img { height: 50px; filter: drop-shadow(0 0 5px var(--neon-green)); }
        .brand h1 {
            font-size: 1.2rem;
            background: linear-gradient(90deg, var(--neon-green), var(--neon-teal));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .connect-btn {
            background: transparent; border: 2px solid var(--neon-teal); color: var(--neon-teal);
            padding: 8px 20px; font-family: 'Orbitron'; font-weight: bold; font-size: 0.8rem;
            cursor: pointer; transition: 0.3s;
            clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .connect-btn:hover { background: var(--neon-teal); color: var(--bg-dark); box-shadow: 0 0 20px var(--neon-teal); }

        /* --- HERO --- */
        .hero {
            margin-top: 80px; padding: 40px 20px; text-align: center;
            background: radial-gradient(circle at center, var(--bg-panel) 0%, var(--bg-dark) 80%);
        }
        .hero h2 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 0 10px var(--neon-green); }
        .hero p { color: var(--neon-teal); font-size: 1.1rem; margin-bottom: 30px; letter-spacing: 1px; }

        /* Stats */
        .stats-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .stat-box {
            background: var(--glass); border: 1px solid var(--neon-green); padding: 20px;
            border-radius: 10px; min-width: 200px; flex: 1; max-width: 300px;
            box-shadow: 0 0 15px rgba(155, 243, 100, 0.1); backdrop-filter: blur(5px);
        }
        .stat-value { font-family: 'Orbitron'; font-size: 1.8rem; color: var(--neon-green); display: block; }
        .stat-label { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; }

        /* --- REFERRAL --- */
        .referral-section {
            background: linear-gradient(90deg, rgba(30, 37, 31, 0.8) 0%, rgba(13, 13, 13, 0.9) 100%);
            border-y: 1px solid var(--neon-green); padding: 20px; margin: 20px auto;
            max-width: 800px; text-align: center; width: 90%;
        }
        .referral-box {
            background: #000; border: 1px dashed var(--neon-teal); padding: 12px; margin: 15px auto;
            font-family: 'Orbitron'; color: var(--neon-teal); font-size: 1rem; cursor: pointer;
            transition: 0.3s; width: 100%; max-width: 400px; overflow-wrap: break-word;
        }
        .referral-box:hover { background: #111; box-shadow: 0 0 15px var(--neon-teal); }

        /* --- MINING --- */
        .mining-section {
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--dark-green) 100%);
            padding: 30px; margin: 20px auto; width: 95%; max-width: 1200px;
            border-radius: 20px; border: 1px solid var(--neon-teal);
            position: relative; overflow: hidden; text-align: center;
        }
        .mining-section::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(78, 213, 210, 0.05) 2px, rgba(78, 213, 210, 0.05) 4px);
            animation: scanline 10s linear infinite; pointer-events: none;
        }
        @keyframes scanline { from { transform: translateY(0); } to { transform: translateY(50px); } }
        
        .mining-display {
            display: flex; justify-content: center; align-items: center; gap: 15px;
            margin: 20px 0;
        }
        .token-logo-mining {
            width: 60px; height: auto;
            filter: drop-shadow(0 0 15px var(--neon-green));
            animation: floatLogo 3s ease-in-out infinite;
        }
        @keyframes floatLogo { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }

        .countdown-timer { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .time-box {
            background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px;
            border: 1px solid var(--neon-teal); min-width: 70px; text-align: center;
        }
        .time-val { font-size: 1.5rem; color: var(--neon-teal); font-weight: bold; font-family: 'Orbitron'; }
        .time-lbl { font-size: 0.7rem; color: #fff; margin-top: 5px; }

        /* --- CHART --- */
        .charts-section { padding: 0 20px; height: 500px; width: 100%; max-width: 1400px; margin: 20px auto; }

        /* --- ECOSYSTEM --- */
        .ecosystem-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px; padding: 30px 20px; max-width: 1200px; margin: 0 auto;
        }
        .eco-card {
            background: var(--bg-panel); padding: 25px; border-radius: 15px; border: 1px solid #333;
            transition: 0.3s; position: relative; overflow: hidden; text-align: center;
        }
        .eco-card:hover { transform: translateY(-5px); border-color: var(--neon-green); box-shadow: 0 0 20px rgba(155, 243, 100, 0.2); }
        .eco-icon { font-size: 2rem; color: var(--neon-teal); margin-bottom: 10px; }
        .coming-soon {
            position: absolute; top: 10px; right: -30px; background: var(--neon-green);
            color: #000; padding: 3px 30px; transform: rotate(45deg); font-size: 0.6rem; font-weight: bold;
        }

        /* --- WHITEPAPER --- */
        .whitepaper-container {
            width: 90%; max-width: 1000px; margin: 30px auto; background: rgba(0,0,0,0.8);
            border: 1px solid var(--neon-teal); padding: 30px; border-radius: 10px;
            box-shadow: 0 0 30px rgba(78, 213, 210, 0.1);
        }
        .wp-content { height: 300px; overflow-y: auto; padding-right: 15px; font-size: 1rem; line-height: 1.6; color: #d1d1d1; text-align: left; }
        .wp-content h2 { color: var(--neon-green); margin-top: 15px; margin-bottom: 5px; border-bottom: 1px solid #333; font-size: 1.2rem; }

        /* --- CHAT --- */
        .ai-float-btn {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--neon-green); border-radius: 50%; display: flex;
            justify-content: center; align-items: center; cursor: pointer;
            box-shadow: 0 0 20px var(--neon-green); z-index: 1000;
            transition: 0.3s; animation: pulse 2s infinite;
        }
        .ai-float-btn:hover { transform: scale(1.1); }
        .ai-float-btn i { font-size: 1.5rem; color: #000; }
        
        .chat-window {
            position: fixed; bottom: 100px; right: 30px; width: 320px; height: 450px;
            background: rgba(13, 13, 13, 0.95); border: 1px solid var(--neon-green);
            border-radius: 15px; display: none; flex-direction: column; z-index: 1000;
            backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .chat-header { background: var(--dark-green); padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--neon-green); }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .chat-input-area { padding: 15px; border-top: 1px solid #333; display: flex; gap: 10px; }
        .chat-input { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; outline: none; }
        .chat-send { background: var(--neon-teal); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .msg { max-width: 80%; padding: 10px; border-radius: 10px; font-size: 0.9rem; }
        .msg.bot { background: rgba(155, 243, 100, 0.1); border: 1px solid var(--neon-green); align-self: flex-start; color: #fff; }
        .msg.user { background: rgba(78, 213, 210, 0.2); border: 1px solid var(--neon-teal); align-self: flex-end; color: #fff; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(155, 243, 100, 0); } 100% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0); } }

        /* --- FOOTER --- */
        footer { background: #000; padding: 40px; text-align: center; border-top: 1px solid var(--dark-green); margin-top: 50px; }
        .social-links { margin-bottom: 20px; }
        .social-links a { color: var(--neon-teal); font-size: 1.8rem; margin: 0 15px; transition: 0.3s; display: inline-block; }
        .social-links a:hover { color: var(--neon-green); text-shadow: 0 0 15px var(--neon-green); transform: translateY(-3px); }

        /* --- MOBILE RESPONSIVE --- */
        @media (max-width: 768px) {
            .brand h1 { font-size: 1rem; }
            .hero h2 { font-size: 1.8rem; }
            .stat-box { min-width: 100%; margin-bottom: 10px; }
            .chat-window { right: 10px; width: 95%; bottom: 100px; }
            .whitepaper-container { padding: 15px; }
            .mining-section { padding: 15px; }
            .time-box { min-width: 50px; padding: 5px; }
            .time-val { font-size: 1rem; }
        }
    </style>
</head>
<body>

    <!-- BACKGROUND AUDIO -->
    <audio id="theme-song" loop>
        <source src="https://ia801402.us.archive.org/16/items/Cyberpunk_Moonlight_Sonata/Cyberpunk_Moonlight_Sonata.mp3" type="audio/mpeg">
    </audio>

    <!-- START SCREEN (To enable Audio) -->
    <div id="start-overlay" onclick="enterSite()">
        <button class="start-btn">ENTER SYSTEM</button>
        <p style="margin-top: 20px; color: #666; font-size: 0.8rem;">CLICK TO INITIALIZE WEB4 PROTOCOL</p>
    </div>

    <!-- CINEMATIC INTRO -->
    <div id="intro-overlay">
        <!-- HEADER LOGO -->
        <img src="https://img.sanishtech.com/u/79b9b77165086fdfbe6eec130c65fa76.png" id="intro-logo" alt="Cryptinity Logo" onerror="this.src='https://img.icons8.com/nolan/200/future.png'">
        <div id="intro-text">WELCOME TO SAFE ZONE</div>
    </div>

    <!-- HEADER -->
    <header>
        <div class="brand">
            <!-- HEADER LOGO -->
            <img src="https://img.sanishtech.com/u/79b9b77165086fdfbe6eec130c65fa76.png" alt="CTY Logo" onerror="this.src='https://img.icons8.com/nolan/64/future.png'">
            <h1>CRYPTINITY WEB4</h1>
        </div>
        <button class="connect-btn" onclick="connectWallet()">CONNECT WALLET</button>
    </header>

    <!-- HERO -->
    <section class="hero">
        <h2>THE FIRST SOCIAL FINANCE PLATFORM</h2>
        <p>Social. Finance. Vault. Security.</p>
        <div class="stats-container">
            <div class="stat-box">
                <span class="stat-value" id="active-members">68,923,021</span>
                <span class="stat-label">Active Members (Live)</span>
            </div>
            <div class="stat-box">
                <span class="stat-value" id="cty-price">$0.00</span>
                <span class="stat-label">CTY Live Price (Pre-Launch)</span>
            </div>
        </div>
    </section>

    <!-- REFERRAL -->
    <section class="referral-section">
        <h3 class="orbitron" style="color: #fff; margin-bottom: 10px;">INVITE & EARN</h3>
        <p style="color: #ccc;">Secure your place in the Safe Zone. Earn <strong>5 CTY</strong> for every invite.</p>
        <div class="referral-box" onclick="copyReferral()">
            <i class="fas fa-link"></i> <span id="ref-link">cryptinity.io/invite/CTY-8X92</span>
        </div>
        <p id="ref-msg" style="color: var(--neon-green); opacity: 0; transition: 0.3s; font-size: 0.8rem;">LINK COPIED</p>
    </section>

    <!-- MINING -->
    <section class="mining-section">
        <h3 class="orbitron" style="font-size: 1.5rem; margin-bottom: 10px;">FREE CLOUD MINING <i class="fas fa-server"></i></h3>
        <div style="text-align: center;">
            <p style="color: #ccc; font-size: 0.9rem;">Mining Speed: <span style="color: var(--neon-green);">145 TH/s</span> | Status: <span style="color: var(--neon-teal);">ONLINE</span></p>
            
            <div class="mining-display">
                <!-- MINING VALUE -->
                <span id="mined-value" style="font-size: 3rem; font-family: 'Orbitron'; text-shadow: 0 0 20px var(--neon-green);">0.00000000</span>
                <!-- MINING TOKEN LOGO (GREEN BIRD) -->
                <img src="https://img.sanishtech.com/u/a662814fe856c2158e9cd8ae981a1b1f.png" alt="CTY" class="token-logo-mining">
            </div>

            <p style="font-size: 0.9rem; color: #aaa;">TRADING LAUNCH IN:</p>
            <div class="countdown-timer" id="countdown"></div>
        </div>
    </section>

    <!-- CHART -->
    <section class="charts-section">
        <div class="tradingview-widget-container" style="height:100%;width:100%">
            <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
            {
            "autosize": true,
            "symbol": "BINANCE:SOLUSDT",
            "interval": "1",
            "timezone": "Etc/UTC",
            "theme": "dark",
            "style": "1",
            "locale": "en",
            "enable_publishing": false,
            "backgroundColor": "rgba(13, 13, 13, 1)",
            "gridColor": "rgba(30, 37, 31, 1)",
            "allow_symbol_change": true,
            "calendar": false,
            "support_host": "https://www.tradingview.com"
            }
            </script>
        </div>
    </section>

    <!-- ECOSYSTEM -->
    <section class="ecosystem-grid">
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-chart-line eco-icon"></i><h3>E-TRADE</h3><p style="color:#888;">Zero-fee DEX.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-credit-card eco-icon"></i><h3>E-CARD</h3><p style="color:#888;">Crypto Debit Card.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-dice eco-icon"></i><h3>DELUXE CASINO</h3><p style="color:#888;">On-chain wagering.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-book-journal-whills eco-icon"></i><h3>E-BOOKS</h3><p style="color:#888;">Decentralized knowledge.</p></div>
    </section>

    <!-- WHITEPAPER -->
    <section class="whitepaper-container">
        <h2 style="text-align: center; margin-bottom: 20px;">OFFICIAL WHITE PAPER v1.0</h2>
        <div class="wp-content">
            <h2>1. ABSTRACT</h2>
            <p><strong>Welcome to the Safe Zone.</strong> The internet is broken. Web2 sold your data; Web3 was too complex. <strong>Cryptinity Web4</strong> is the next evolutionâ€”a "Sci-Fi Hybrid" ecosystem that unifies Social Interaction, High-Speed Finance, Digital Vaults, and Military-Grade Security into a single mobile application.</p>
            <h2>2. THE PROBLEM</h2>
            <p>The current digital landscape is fragmented and hostile. Social Manipulation, Financial Friction, and Security Failures plague users daily.</p>
            <h2>3. THE SOLUTION: THE 4 PILLARS</h2>
            <p><strong>Pillar I: SOCIAL (Zero-Algorithm)</strong> - No Manipulation. Organic Reach.<br>
            <strong>Pillar II: FINANCE</strong> - Faster Than Light transaction speeds using Solana PoH.<br>
            <strong>Pillar III: THE VAULT</strong> - Self-Custody Neo-Bank with zero hidden fees.<br>
            <strong>Pillar IV: SECURITY</strong> - Imunify 360 Integration and Web4 Hybrid Architecture.</p>
            <h2>4. THE TOKEN: CTY</h2>
            <p><strong>Ticker:</strong> CTY<br><strong>Network:</strong> Solana (SPL Token-2022)<br><strong>Supply:</strong> 1,000,000,000</p>
            <h2>6. CONCLUSION</h2>
            <p>The era of slow banking and manipulated social feeds is over. <strong>Welcome to the Safe Zone.</strong></p>
        </div>
    </section>

    <!-- CHAT -->
    <div class="ai-float-btn" onclick="toggleChat()"><i class="fas fa-robot"></i></div>
    <div class="chat-window" id="chat-window">
        <div class="chat-header">
            <span class="orbitron" style="color: var(--neon-teal);">CRYPTINITY AI</span>
            <i class="fas fa-times" style="cursor: pointer;" onclick="toggleChat()"></i>
        </div>
        <div class="chat-body" id="chat-body">
            <div class="msg bot">Greetings, Commander. I am the Sentinel AI. How can I assist you with Cryptinity Web4 today?</div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chat-input" class="chat-input" placeholder="Ask about CTY, Mining..." onkeypress="handleEnter(event)">
            <button class="chat-send" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="social-links">
            <a href="https://x.com/@cryptinity85164" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="https://t.me/ctyweb4" target="_blank"><i class="fab fa-telegram"></i></a>
            <a href="https://discord.gg/Wu43MFM9w" target="_blank"><i class="fab fa-discord"></i></a>
            <a href="https://facebook.com/cryptinity" target="_blank"><i class="fab fa-facebook"></i></a>
            <a href="https://youtube.com/@cryptinity" target="_blank"><i class="fab fa-youtube"></i></a>
        </div>
        <p style="margin-top: 20px; color: #555;">&copy; 2025 Cryptinity Web4. All rights reserved.</p>
    </footer>

    <script>
        // --- 0. ENTER SYSTEM & AUDIO ---
        function enterSite() {
            // Hide Start Overlay
            document.getElementById('start-overlay').style.display = 'none';
            // Show Cinematic Intro
            const intro = document.getElementById('intro-overlay');
            intro.classList.add('intro-active');
            // Play Audio
            const audio = document.getElementById('theme-song');
            audio.volume = 0.5; // Set volume to 50%
            audio.play().catch(e => console.log("Audio play failed:", e));
        }

        // --- 1. PERSISTENT MEMBERS ---
        const memberEl = document.getElementById('active-members');
        let currentMembers = parseInt(localStorage.getItem('cty_members')) || 68923021;
        
        function updateMembers() {
            const change = Math.floor(Math.random() * 5); // Always grows 0-5
            currentMembers += change;
            localStorage.setItem('cty_members', currentMembers);
            memberEl.innerText = currentMembers.toLocaleString();
        }
        setInterval(updateMembers, 3000);
        memberEl.innerText = currentMembers.toLocaleString();

        // --- 2. PERSISTENT & OFFLINE MINING ---
        const minedEl = document.getElementById('mined-value');
        let minedAmount = parseFloat(localStorage.getItem('cty_mined')) || 0.00000000;
        let lastTime = parseInt(localStorage.getItem('cty_last_time')) || Date.now();
        const miningRatePerMs = 0.00000145 / 100; // Rate based on previous interval

        // Calculate offline earnings
        const nowTime = Date.now();
        const diffTime = nowTime - lastTime;
        if(diffTime > 0) {
            const offlineEarnings = diffTime * miningRatePerMs;
            minedAmount += offlineEarnings;
            console.log("Welcome back Commander. You mined " + offlineEarnings.toFixed(8) + " CTY while away.");
        }

        function mineLoop() {
            minedAmount += 0.00000145;
            minedEl.innerText = minedAmount.toFixed(8);
            localStorage.setItem('cty_mined', minedAmount);
            localStorage.setItem('cty_last_time', Date.now());
        }
        setInterval(mineLoop, 100);

        // --- 3. PERSISTENT COUNTDOWN ---
        let launchDate = localStorage.getItem('cty_launch_date');
        if (!launchDate) {
            // Set 90 days from FIRST visit
            const target = new Date();
            target.setDate(target.getDate() + 90);
            launchDate = target.getTime();
            localStorage.setItem('cty_launch_date', launchDate);
        }

        function updateCountdown() {
            const now = new Date().getTime();
            const distance = launchDate - now;

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            document.getElementById("countdown").innerHTML = `
                <div class="time-box"><div class="time-val">${days}</div><div class="time-lbl">DAYS</div></div>
                <div class="time-box"><div class="time-val">${hours}</div><div class="time-lbl">HRS</div></div>
                <div class="time-box"><div class="time-val">${minutes}</div><div class="time-lbl">MIN</div></div>
                <div class="time-box"><div class="time-val">${seconds}</div><div class="time-lbl">SEC</div></div>
            `;
        }
        setInterval(updateCountdown, 1000);

        // --- 4. UTILS ---
        function connectWallet() {
            const btn = document.querySelector('.connect-btn');
            btn.innerText = "CONNECTING...";
            setTimeout(() => {
                btn.innerText = "0x89...2B4";
                btn.style.borderColor = "#9bf364";
                btn.style.color = "#9bf364";
                alert("Welcome to the Safe Zone, Commander.");
            }, 1500);
        }

        function copyReferral() {
            const link = "https://cryptinity.io/invite/CTY-8X92";
            
            // Modern Clipboard API - Primary method
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(link).then(() => {
                    showCopiedMsg();
                }).catch(err => {
                    console.error("Clipboard API failed: ", err);
                    copyReferralFallback(link);
                });
            } else {
                // Fallback for older browsers or non-secure contexts
                copyReferralFallback(link);
            }
        }

        function copyReferralFallback(text) {
            // Create a temporary textarea element
            const textArea = document.createElement("textarea");
            textArea.value = text;
            
            // Ensure it's not visible but part of the DOM
            textArea.style.position = "fixed";
            textArea.style.left = "-9999px";
            textArea.style.top = "0";
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showCopiedMsg();
                } else {
                    console.error('Fallback: Copying text command was unsuccessful');
                    alert("Please manually copy the link: " + text);
                }
            } catch (err) {
                console.error('Fallback: Oops, unable to copy', err);
                alert("Please manually copy the link: " + text);
            }
            
            document.body.removeChild(textArea);
        }

        function showCopiedMsg() {
            const msg = document.getElementById('ref-msg');
            msg.style.opacity = '1';
            setTimeout(() => { msg.style.opacity = '0'; }, 2000);
        }

        // --- 5. AI CHAT ---
        function toggleChat() {
            const win = document.getElementById('chat-window');
            win.style.display = (win.style.display === 'flex') ? 'none' : 'flex';
        }

        function handleEnter(e) { if (e.key === 'Enter') sendMessage(); }

        function sendMessage() {
            const input = document.getElementById('chat-input');
            const body = document.getElementById('chat-body');
            const text = input.value.trim();
            if (text === "") return;

            body.innerHTML += `<div class="msg user">${text}</div>`;
            input.value = "";
            body.scrollTop = body.scrollHeight;

            setTimeout(() => {
                let reply = "Calculating trajectory... Check the White Paper.";
                const lower = text.toLowerCase();
                if (lower.includes("hello")) reply = "Systems online. Welcome to Cryptinity.";
                else if (lower.includes("cty")) reply = "CTY is the native fuel of Web4. Supply: 1B.";
                else if (lower.includes("mining")) reply = "Cloud mining active at 145 TH/s.";
                else if (lower.includes("safe") || lower.includes("referral")) reply = "Earn 5 CTY per invite. Share your link.";
                
                body.innerHTML += `<div class="msg bot">${reply}</div>`;
                body.scrollTop = body.scrollHeight;
            }, 800);
        }
    </script>
</body>
</html>