<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cryptinity Web4 | The Safe Zone</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@300;500;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getFirestore, doc, updateDoc, increment, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyALkLkbBr2SCxLyon970oyoBr2hmfFu0kE",
        authDomain: "cryptinity--ultra--web4.firebaseapp.com",
        projectId: "cryptinity--ultra--web4",
        storageBucket: "cryptinity--ultra--web4.firebasestorage.app",
        messagingSenderId: "624069180316",
        appId: "1:624069180316:web:124ddb51d9194fe539a659"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      window.db = db; 
      window.firestoreFunctions = { doc, updateDoc, increment, setDoc, getDoc };
      console.log("Cryptinity Web4 Network: SECURE");
    </script>

    <style>
        :root {
            --bg-dark: #0d0d0d;
            --bg-panel: #1e251f;
            --neon-green: #9bf364;
            --neon-teal: #4ed5d2;
            --dark-green: #0e6011;
            --text-main: #ffffff;
            --text-muted: #aabaac;
            --glass: rgba(30, 37, 31, 0.85);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: var(--text-main);
            font-family: 'Rajdhani', sans-serif;
            overflow-x: hidden;
        }

        h1, h2, h3, .orbitron { font-family: 'Orbitron', sans-serif; text-transform: uppercase; }

        /* --- OVERLAYS --- */
        #start-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 10000;
            display: flex; justify-content: center; align-items: center; flex-direction: column;
            cursor: pointer;
        }
        .start-btn {
            border: 2px solid var(--neon-green); color: var(--neon-green);
            padding: 20px 40px; font-family: 'Orbitron'; font-size: 1.5rem;
            background: rgba(0,0,0,0.8); letter-spacing: 3px;
            animation: pulseBtn 1.5s infinite;
            text-transform: uppercase;
        }
        @keyframes pulseBtn {
            0% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(155, 243, 100, 0); }
            100% { box-shadow: 0 0 0 0 rgba(155, 243, 100, 0); }
        }

        #intro-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #000; z-index: 9999;
            display: none; justify-content: center; align-items: center; flex-direction: column;
            pointer-events: none;
        }
        .intro-active { display: flex !important; animation: fadeOut 2s ease-in-out 3s forwards; }
        #intro-logo { width: 250px; opacity: 0; animation: logoReveal 2s ease-out 0.5s forwards; filter: drop-shadow(0 0 30px var(--neon-green)); }
        #intro-text { margin-top: 20px; font-size: 2rem; color: var(--neon-teal); letter-spacing: 5px; opacity: 0; font-family: 'Orbitron'; animation: textReveal 1s ease-out 1.5s forwards; }
        @keyframes logoReveal { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        @keyframes textReveal { 0% { letter-spacing: 15px; opacity: 0; } 100% { letter-spacing: 5px; opacity: 1; } }
        @keyframes fadeOut { 0% { opacity: 1; } 100% { opacity: 0; pointer-events: none; } }

        /* --- MODAL --- */
        .modal {
            display: none; position: fixed; z-index: 10001; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.9); justify-content: center; align-items: center;
        }
        .modal-content {
            background: linear-gradient(135deg, #0d0d0d, #1a221b);
            border: 2px solid var(--neon-green); padding: 40px; text-align: center;
            width: 90%; max-width: 500px; box-shadow: 0 0 50px rgba(155, 243, 100, 0.3);
            border-radius: 10px; animation: modalPop 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            position: relative;
        }
        @keyframes modalPop { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .modal h2 { color: var(--neon-green); font-size: 1.8rem; margin-bottom: 20px; letter-spacing: 2px; }
        .modal p { color: #fff; font-size: 1.1rem; margin-bottom: 30px; font-family: 'Rajdhani'; }
        .modal-btn {
            background: transparent; border: 1px solid var(--neon-teal); color: var(--neon-teal);
            padding: 10px 30px; font-family: 'Orbitron'; font-size: 1rem; cursor: pointer; transition: 0.3s;
        }
        .modal-btn:hover { background: var(--neon-teal); color: #000; box-shadow: 0 0 20px var(--neon-teal); }

        /* --- HEADER --- */
        header {
            position: fixed; top: 0; width: 100%; padding: 10px 20px;
            background: rgba(13, 13, 13, 0.95); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--dark-green); z-index: 100;
            box-shadow: 0 0 20px rgba(14, 96, 17, 0.3);
        }
        .brand { display: flex; align-items: center; gap: 10px; }
        .brand img { height: 50px; filter: drop-shadow(0 0 5px var(--neon-green)); }
        .brand h1 { font-size: 1.2rem; background: linear-gradient(90deg, var(--neon-green), var(--neon-teal)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-wrapper { display: flex; align-items: center; gap: 15px; }
        .uid-badge {
            font-family: 'Orbitron'; font-size: 0.85rem; color: var(--neon-green);
            background: rgba(14, 96, 17, 0.3); border: 1px solid var(--neon-green);
            padding: 5px 10px; border-radius: 4px; display: none; box-shadow: 0 0 10px rgba(155, 243, 100, 0.2);
        }
        .connect-container { position: relative; display: flex; align-items: center; }
        .blockchain-light {
            width: 10px; height: 10px; background-color: var(--neon-green); border-radius: 50%;
            margin-right: 10px; box-shadow: 0 0 10px var(--neon-green), 0 0 20px var(--neon-green);
            display: none; animation: pulseLight 1.5s infinite alternate;
        }
        @keyframes pulseLight { 0% { opacity: 0.6; box-shadow: 0 0 5px var(--neon-green); } 100% { opacity: 1; box-shadow: 0 0 15px var(--neon-green), 0 0 25px var(--neon-green); } }
        .connect-btn {
            background: transparent; border: 2px solid var(--neon-teal); color: var(--neon-teal);
            padding: 8px 20px; font-family: 'Orbitron'; font-weight: bold; font-size: 0.8rem;
            cursor: pointer; transition: 0.3s; clip-path: polygon(10% 0, 100% 0, 100% 70%, 90% 100%, 0 100%, 0 30%);
        }
        .connect-btn:hover { background: var(--neon-teal); color: var(--bg-dark); box-shadow: 0 0 20px var(--neon-teal); }

        /* --- HERO --- */
        .hero {
            margin-top: 80px; padding: 40px 20px; text-align: center;
            background: radial-gradient(circle at center, var(--bg-panel) 0%, var(--bg-dark) 80%);
        }
        .hero h2 { font-size: 2.5rem; margin-bottom: 10px; text-shadow: 0 0 10px var(--neon-green); }
        .hero p { color: var(--neon-teal); font-size: 1.1rem; margin-bottom: 30px; letter-spacing: 1px; }

        /* Stats */
        .stats-container { display: flex; justify-content: center; gap: 20px; flex-wrap: wrap; }
        .stat-box {
            background: var(--glass); border: 1px solid var(--neon-green); padding: 20px;
            border-radius: 10px; min-width: 200px; flex: 1; max-width: 300px;
            box-shadow: 0 0 15px rgba(155, 243, 100, 0.1); backdrop-filter: blur(5px);
        }
        .stat-value { font-family: 'Orbitron'; font-size: 1.8rem; color: var(--neon-green); display: block; }
        .stat-label { color: var(--text-muted); font-size: 0.8rem; text-transform: uppercase; }

        /* --- HYBRID REFERRAL SECTION --- */
        .referral-container { width: 90%; max-width: 900px; margin: 30px auto; position: relative; }
        
        .ref-locked {
            border: 1px solid #333; background: rgba(13, 13, 13, 0.9);
            padding: 30px; text-align: center; border-radius: 10px; border-bottom: 2px solid var(--neon-teal);
        }
        .ref-locked i { font-size: 2rem; color: #555; margin-bottom: 10px; }
        
        .hybrid-panel {
            display: none; background: rgba(20, 25, 22, 0.6); backdrop-filter: blur(10px);
            border: 1px solid rgba(155, 243, 100, 0.3); border-left: 4px solid var(--neon-green);
            padding: 30px; position: relative; animation: panelFade 0.8s ease-out;
            clip-path: polygon(0 0, 100% 0, 100% 85%, 95% 100%, 0 100%);
        }
        @keyframes panelFade { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .hybrid-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        .hybrid-title { font-family: 'Orbitron'; color: #fff; font-size: 1.2rem; display: flex; align-items: center; gap: 10px; }
        .hybrid-badge { background: var(--neon-teal); color: #000; font-size: 0.7rem; padding: 2px 8px; font-weight: bold; border-radius: 2px; }
        .hybrid-body { display: flex; flex-direction: column; gap: 15px; }
        .hybrid-link-box { display: flex; background: #000; border: 1px solid #333; padding: 0; align-items: center; }
        .link-text {
            flex: 1; color: var(--neon-teal); font-family: 'Rajdhani'; font-size: 1rem;
            padding: 15px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
        }
        .hybrid-copy-btn {
            background: rgba(155, 243, 100, 0.1); border: none; border-left: 1px solid var(--neon-green);
            color: var(--neon-green); font-family: 'Orbitron'; cursor: pointer;
            padding: 15px 25px; transition: 0.3s; font-size: 0.9rem;
        }
        .hybrid-copy-btn:hover { background: var(--neon-green); color: #000; }
        .hybrid-footer { margin-top: 15px; display: flex; gap: 15px; font-size: 0.8rem; color: #888; }
        .h-stat { color: var(--neon-green); font-weight: bold; }

        /* --- MINING SECTIONS --- */
        .mining-locked {
            border: 1px solid #333; background: rgba(13, 13, 13, 0.8);
            padding: 40px; margin: 20px auto; width: 95%; max-width: 1200px;
            border-radius: 20px; text-align: center; border-left: 3px solid var(--neon-teal);
        }
        .mining-locked h3 { color: var(--text-muted); font-size: 1.2rem; margin-bottom: 10px; }
        .mining-locked .lock-msg {
            font-family: 'Orbitron'; color: var(--neon-teal); font-size: 1.5rem;
            text-shadow: 0 0 10px var(--neon-teal); animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.5; } }

        .mining-section {
            background: linear-gradient(180deg, var(--bg-dark) 0%, var(--dark-green) 100%);
            padding: 30px; margin: 20px auto; width: 95%; max-width: 1200px;
            border-radius: 20px; border: 1px solid var(--neon-teal);
            position: relative; overflow: hidden; text-align: center;
            display: none; opacity: 0; transition: opacity 1s ease-in;
        }
        .mining-section.visible { display: block; opacity: 1; animation: slideDown 1s ease-out; }
        @keyframes slideDown { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .mining-section::before {
            content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
            background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(78, 213, 210, 0.05) 2px, rgba(78, 213, 210, 0.05) 4px);
            animation: scanline 10s linear infinite; pointer-events: none;
        }
        @keyframes scanline { from { transform: translateY(0); } to { transform: translateY(50px); } }
        .mining-display { display: flex; justify-content: center; align-items: center; gap: 15px; margin: 20px 0; }
        
        /* --- WITHDRAWAL & OTHERS --- */
        .countdown-timer { display: flex; justify-content: center; gap: 10px; margin-top: 20px; flex-wrap: wrap; }
        .time-box { background: rgba(0,0,0,0.8); padding: 10px; border-radius: 5px; border: 1px solid var(--neon-teal); min-width: 70px; text-align: center; }
        .time-val { font-size: 1.5rem; color: var(--neon-teal); font-weight: bold; font-family: 'Orbitron'; }
        .time-lbl { font-size: 0.7rem; color: #fff; margin-top: 5px; }

        .withdrawal-box {
            margin-top: 40px; background: rgba(0,0,0,0.6); border: 1px solid var(--neon-green);
            padding: 20px; border-radius: 10px; max-width: 500px; margin-left: auto; margin-right: auto;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }
        .w-input-group { margin-bottom: 15px; text-align: left; }
        .w-label { display: block; color: var(--neon-teal); font-size: 0.8rem; margin-bottom: 5px; font-family: 'Orbitron'; }
        .w-input {
            width: 100%; background: #111; border: 1px solid #333; color: #fff;
            padding: 10px; font-family: 'Rajdhani'; font-size: 1rem; outline: none; transition: 0.3s;
        }
        .w-input:focus { border-color: var(--neon-green); box-shadow: 0 0 10px rgba(155, 243, 100, 0.2); }
        .w-btn {
            width: 100%; padding: 12px; background: var(--dark-green); color: #fff;
            border: 1px solid var(--neon-green); font-family: 'Orbitron';
            cursor: pointer; transition: 0.3s; text-transform: uppercase;
        }
        .w-btn:hover { background: var(--neon-green); color: #000; box-shadow: 0 0 20px var(--neon-green); }

        .charts-section { padding: 0 20px; height: 500px; width: 100%; max-width: 1400px; margin: 20px auto; }
        .ecosystem-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; padding: 30px 20px; max-width: 1200px; margin: 0 auto; }
        .eco-card {
            background: var(--bg-panel); padding: 25px; border-radius: 15px; border: 1px solid #333;
            transition: 0.3s; position: relative; overflow: hidden; text-align: center;
        }
        .eco-card:hover { transform: translateY(-5px); border-color: var(--neon-green); box-shadow: 0 0 20px rgba(155, 243, 100, 0.2); }
        .eco-icon { font-size: 2rem; color: var(--neon-teal); margin-bottom: 10px; }
        .coming-soon { position: absolute; top: 10px; right: -30px; background: var(--neon-green); color: #000; padding: 3px 30px; transform: rotate(45deg); font-size: 0.6rem; font-weight: bold; }

        .whitepaper-container { width: 90%; max-width: 1000px; margin: 30px auto; background: rgba(0,0,0,0.8); border: 1px solid var(--neon-teal); padding: 30px; border-radius: 10px; box-shadow: 0 0 30px rgba(78, 213, 210, 0.1); }
        .wp-content { height: 300px; overflow-y: auto; padding-right: 15px; font-size: 1rem; line-height: 1.6; color: #d1d1d1; text-align: left; }
        .wp-content h2 { color: var(--neon-green); margin-top: 15px; margin-bottom: 5px; border-bottom: 1px solid #333; font-size: 1.2rem; }

        .ai-float-btn {
            position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px;
            background: var(--neon-green); border-radius: 50%; display: flex; justify-content: center; align-items: center; cursor: pointer;
            box-shadow: 0 0 20px var(--neon-green); z-index: 1000; transition: 0.3s; animation: pulse 2s infinite;
        }
        .ai-float-btn:hover { transform: scale(1.1); }
        .ai-float-btn i { font-size: 1.5rem; color: #000; }

        .audio-btn {
            position: fixed; bottom: 30px; left: 30px; width: 50px; height: 50px;
            background: rgba(13, 13, 13, 0.9); border: 1px solid var(--neon-teal);
            border-radius: 50%; display: none; justify-content: center; align-items: center; cursor: pointer;
            z-index: 1000; transition: 0.3s; box-shadow: 0 0 10px var(--neon-teal);
        }
        .audio-btn:hover { transform: scale(1.1); background: var(--neon-teal); }
        .audio-btn:hover i { color: #000; }
        .audio-btn i { color: var(--neon-teal); font-size: 1.2rem; transition: 0.3s; }

        .chat-window {
            position: fixed; bottom: 100px; right: 30px; width: 320px; height: 450px;
            background: rgba(13, 13, 13, 0.95); border: 1px solid var(--neon-green); border-radius: 15px; display: none; flex-direction: column; z-index: 1000; backdrop-filter: blur(10px); box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }
        .chat-header { background: var(--dark-green); padding: 15px; border-radius: 15px 15px 0 0; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--neon-green); }
        .chat-body { flex: 1; padding: 15px; overflow-y: auto; display: flex; flex-direction: column; gap: 10px; }
        .chat-input-area { padding: 15px; border-top: 1px solid #333; display: flex; gap: 10px; }
        .chat-input { flex: 1; background: #222; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 5px; outline: none; }
        .chat-send { background: var(--neon-teal); border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer; }
        .msg { max-width: 80%; padding: 10px; border-radius: 10px; font-size: 0.9rem; }
        .msg.bot { background: rgba(155, 243, 100, 0.1); border: 1px solid var(--neon-green); align-self: flex-start; color: #fff; }
        .msg.user { background: rgba(78, 213, 210, 0.2); border: 1px solid var(--neon-teal); align-self: flex-end; color: #fff; }

        footer { background: #000; padding: 40px; text-align: center; border-top: 1px solid var(--dark-green); margin-top: 50px; }
        .social-links { margin-bottom: 20px; }
        .social-links a { color: var(--neon-teal); font-size: 1.8rem; margin: 0 15px; transition: 0.3s; display: inline-block; }
        .social-links a:hover { color: var(--neon-green); text-shadow: 0 0 15px var(--neon-green); transform: translateY(-3px); }

        @media (max-width: 768px) {
            .brand h1 { font-size: 1rem; }
            .hero h2 { font-size: 1.8rem; }
            .stat-box { min-width: 100%; margin-bottom: 10px; }
            .chat-window { right: 10px; width: 95%; bottom: 100px; }
            .whitepaper-container { padding: 15px; }
            .mining-section { padding: 15px; }
            .time-box { min-width: 50px; padding: 5px; }
            .time-val { font-size: 1rem; }
            .login-wrapper { gap: 5px; }
            .uid-badge { font-size: 0.6rem; padding: 3px 6px; }
            .blockchain-light { width: 8px; height: 8px; margin-right: 5px; }
            .audio-btn { left: 15px; bottom: 15px; width: 40px; height: 40px; }
            .ai-float-btn { right: 15px; bottom: 15px; width: 40px; height: 40px; }
            .hybrid-header { flex-direction: column; align-items: flex-start; gap: 5px; }
        }
    </style>
</head>
<body>

    <audio id="theme-song" loop>
        <source src="cyberpunk-metaverse-event-background-music-391980.mp3" type="audio/mpeg">
    </audio>

    <div id="audio-control" class="audio-btn" onclick="toggleMute()">
        <i class="fas fa-volume-up" id="audio-icon"></i>
    </div>

    <div id="start-overlay" onclick="enterSite()">
        <button class="start-btn">ENTER SYSTEM</button>
        <p style="margin-top: 20px; color: #666; font-size: 0.8rem;">CLICK TO INITIALIZE WEB4 PROTOCOL</p>
    </div>

    <div id="intro-overlay">
        <img src="https://img.sanishtech.com/u/79b9b77165086fdfbe6eec130c65fa76.png" id="intro-logo" alt="Cryptinity Logo" onerror="this.src='https://img.icons8.com/nolan/200/future.png'">
        <div id="intro-text">WELCOME TO SAFE ZONE</div>
    </div>

    <div id="welcome-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">WELCOME NEW WEB4 CITIZEN</h2>
            <p id="modal-msg">Identity Verified. Protocol Access Granted.</p>
            <button class="modal-btn" onclick="closeModal()">ENTER SAFE ZONE</button>
        </div>
    </div>

    <header>
        <div class="brand">
            <img src="https://img.sanishtech.com/u/79b9b77165086fdfbe6eec130c65fa76.png" alt="CTY Logo" onerror="this.src='https://img.icons8.com/nolan/64/future.png'">
            <h1>CRYPTINITY WEB4</h1>
        </div>
        <div class="login-wrapper">
            <div id="user-uid" class="uid-badge"></div>
            <div class="connect-container">
                <div id="status-light" class="blockchain-light"></div>
                <button id="connect-btn" class="connect-btn" onclick="connectWallet()">CONNECT WALLET</button>
            </div>
        </div>
    </header>

    <section class="hero">
        <h2>THE FIRST SOCIAL FINANCE PLATFORM</h2>
        <p>Social. Finance. Vault. Security.</p>
        <div class="stats-container">
            <div class="stat-box"><span class="stat-value" id="active-members">68,923,021</span><span class="stat-label">Active Members (Live)</span></div>
            <div class="stat-box"><span class="stat-value" id="cty-price">$0.00</span><span class="stat-label">CTY Live Price (Pre-Launch)</span></div>
        </div>
    </section>

    <section class="referral-container">
        <div id="ref-locked" class="ref-locked">
            <i class="fas fa-lock"></i>
            <h3 class="orbitron" style="color: #666; margin-bottom: 5px;">SYSTEM ENCRYPTED</h3>
            <p style="color: #444; font-size: 0.9rem;">CONNECT WALLET TO GENERATE REFERRAL LINK</p>
        </div>
        <div id="ref-unlocked" class="hybrid-panel">
            <div class="hybrid-header">
                <div class="hybrid-title"><i class="fas fa-network-wired" style="color: var(--neon-teal);"></i> INVITE PROTOCOL <span class="hybrid-badge">ACTIVE</span></div>
                <div style="font-family: 'Rajdhani'; color: #888;">REWARD: <span style="color: var(--neon-green);">5 CTY</span> / INVITE</div>
            </div>
            <div class="hybrid-body">
                <div class="hybrid-link-box">
                    <div class="link-text" id="ref-link-text">Waiting for generation...</div>
                    <button class="hybrid-copy-btn" onclick="copyReferral()"><i class="fas fa-copy"></i> COPY PROTOCOL</button>
                </div>
                <div class="hybrid-footer">
                    <span><i class="fas fa-users"></i> INVITES: <span class="h-stat" id="ref-count">0</span></span>
                    <span><i class="fas fa-coins"></i> EARNED: <span class="h-stat" id="ref-earned">0.00 CTY</span></span>
                </div>
            </div>
            <p id="ref-msg" style="color: var(--neon-green); text-align: center; margin-top: 10px; opacity: 0; transition: 0.3s; font-size: 0.8rem;">PROTOCOL COPIED TO CLIPBOARD</p>
        </div>
    </section>

    <div id="mining-placeholder" class="mining-locked">
        <h3>MINING STATION STATUS: <span style="color: #666;">STANDBY</span></h3>
        <div class="lock-msg">CONNECT YOUR WEB4 WALLET TO START MINING</div>
    </div>

    <section class="mining-section" id="mining-area">
        <h3 class="orbitron" style="font-size: 1.5rem; margin-bottom: 10px;">FREE CLOUD MINING <i class="fas fa-server"></i></h3>
        <div style="text-align: center;">
            <p style="color: #ccc; font-size: 0.9rem;">Mining Speed: <span style="color: var(--neon-green);">145 TH/s</span> | Status: <span style="color: var(--neon-teal);">ONLINE</span></p>
            <div class="mining-display"><span id="mined-value" style="font-size: 3rem; font-family: 'Orbitron'; text-shadow: 0 0 20px var(--neon-green);">0.00000000</span></div>
            <p style="font-size: 0.9rem; color: #aaa;">TRADING LAUNCH IN:</p>
            <div class="countdown-timer" id="countdown"></div>
            <div class="withdrawal-box">
                <h4 class="orbitron" style="color: var(--neon-green); margin-bottom: 20px;">WITHDRAW CTY</h4>
                <div class="w-input-group"><label class="w-label">RECEIVING WALLET</label><input type="text" class="w-input" placeholder="Ex. 0x8935...."></div>
                <div class="w-input-group"><label class="w-label">AMOUNT (CTY)</label><input type="number" class="w-input" placeholder="Ex. Minimum withdrawal 50 CTY"></div>
                <button class="w-btn" onclick="processWithdrawal()">INITIATE TRANSFER</button>
            </div>
        </div>
    </section>

    <section class="charts-section">
        <div class="tradingview-widget-container" style="height:100%;width:100%">
            <div class="tradingview-widget-container__widget" style="height:100%;width:100%"></div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js" async>
            {"autosize": true,"symbol": "BINANCE:SOLUSDT","interval": "1","timezone": "Etc/UTC","theme": "dark","style": "1","locale": "en","enable_publishing": false,"backgroundColor": "rgba(13, 13, 13, 1)","gridColor": "rgba(30, 37, 31, 1)","allow_symbol_change": true,"calendar": false,"support_host": "https://www.tradingview.com"}
            </script>
        </div>
    </section>

    <section class="ecosystem-grid">
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-chart-line eco-icon"></i><h3>E-TRADE</h3><p style="color:#888;">Zero-fee DEX.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-credit-card eco-icon"></i><h3>E-CARD</h3><p style="color:#888;">Crypto Debit Card.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-dice eco-icon"></i><h3>DELUXE CASINO</h3><p style="color:#888;">On-chain wagering.</p></div>
        <div class="eco-card"><div class="coming-soon">SOON</div><i class="fas fa-book-journal-whills eco-icon"></i><h3>E-BOOKS</h3><p style="color:#888;">Decentralized knowledge.</p></div>
    </section>

    <section class="whitepaper-container">
        <h2 style="text-align: center; margin-bottom: 20px;">OFFICIAL WHITE PAPER v1.0</h2>
        <div class="wp-content">
            <h2>1. ABSTRACT</h2><p><strong>Welcome to the Safe Zone.</strong> The internet is broken. Web2 sold your data; Web3 was too complex. <strong>Cryptinity Web4</strong> is the next evolution.</p>
            <h2>2. THE PROBLEM</h2><p>The current digital landscape is fragmented and hostile.</p>
            <h2>4. THE TOKEN: CTY</h2><p><strong>Ticker:</strong> CTY<br><strong>Network:</strong> Solana (SPL Token-2022)</p>
        </div>
    </section>

    <div class="ai-float-btn" onclick="toggleChat()"><i class="fas fa-robot"></i></div>
    <div class="chat-window" id="chat-window">
        <div class="chat-header"><span class="orbitron" style="color: var(--neon-teal);">CRYPTINITY AI</span><i class="fas fa-times" style="cursor: pointer;" onclick="toggleChat()"></i></div>
        <div class="chat-body" id="chat-body"><div class="msg bot">Greetings, Commander. I am the Sentinel AI. How can I assist you?</div></div>
        <div class="chat-input-area"><input type="text" id="chat-input" class="chat-input" placeholder="Ask about CTY..." onkeypress="handleEnter(event)"><button class="chat-send" onclick="sendMessage()"><i class="fas fa-paper-plane"></i></button></div>
    </div>

    <footer>
        <div class="social-links">
            <a href="https://x.com/@cryptinity85164" target="_blank"><i class="fab fa-twitter"></i></a>
            <a href="https://t.me/ctyweb4" target="_blank"><i class="fab fa-telegram"></i></a>
            <a href="https://discord.gg/Wu43MFM9w" target="_blank"><i class="fab fa-discord"></i></a>
        </div>
        <p style="margin-top: 20px; color: #555;">&copy; 2025 Cryptinity Web4. All rights reserved.</p>
    </footer>

    <script>
        // --- 0. STARTUP LOGIC: CAPTURE REFERRAL & DETECT WALLET ---
        let detectedWalletType = null; // 'solana' or 'ethereum' or null

        window.onload = function() {
            // Check for ?ref= in the URL
            const urlParams = new URLSearchParams(window.location.search);
            const refID = urlParams.get('ref');
            
            if (refID) {
                console.log("Referred by:", refID);
                localStorage.setItem('cty_referrer', refID);
            }

            // --- AUTO DETECT WALLET INSTALLED ---
            setTimeout(() => {
                const btn = document.getElementById('connect-btn');
                
                // Check Solana (Phantom)
                if (window.solana && window.solana.isPhantom) {
                    detectedWalletType = 'solana';
                    console.log("System: Phantom Wallet Detected");
                    btn.innerText = "PHANTOM DETECTED";
                    btn.style.borderColor = "var(--neon-teal)";
                } 
                // Check Ethereum (MetaMask)
                else if (window.ethereum) {
                    detectedWalletType = 'ethereum';
                    console.log("System: MetaMask Detected");
                    btn.innerText = "METAMASK DETECTED";
                    btn.style.borderColor = "orange";
                    btn.style.color = "orange";
                }
                else {
                    console.log("System: No Wallet Detected (Using Simulation Mode)");
                }
            }, 1000);
        };

        // --- 1. ENTER SYSTEM ---
        function enterSite() {
            document.getElementById('start-overlay').style.display = 'none';
            const intro = document.getElementById('intro-overlay');
            intro.classList.add('intro-active');
            
            const audio = document.getElementById('theme-song');
            audio.volume = 0.6; 
            audio.play().then(() => {
                document.getElementById('audio-control').style.display = 'flex';
            }).catch(e => console.log("Audio blocked"));
        }

        // --- 2. AUDIO TOGGLE ---
        function toggleMute() {
            const audio = document.getElementById('theme-song');
            const icon = document.getElementById('audio-icon');
            const btn = document.getElementById('audio-control');
            if (audio.muted) {
                audio.muted = false; icon.classList.remove('fa-volume-mute'); icon.classList.add('fa-volume-up');
                btn.style.borderColor = 'var(--neon-teal)'; btn.style.boxShadow = '0 0 10px var(--neon-teal)';
            } else {
                audio.muted = true; icon.classList.remove('fa-volume-up'); icon.classList.add('fa-volume-mute');
                btn.style.borderColor = '#555'; btn.style.boxShadow = 'none';
            }
        }

        // --- 3. PERSISTENT MEMBERS ---
        const memberEl = document.getElementById('active-members');
        let currentMembers = parseInt(localStorage.getItem('cty_members')) || 68923021;
        function updateMembers() {
            currentMembers += Math.floor(Math.random() * 5);
            localStorage.setItem('cty_members', currentMembers);
            memberEl.innerText = currentMembers.toLocaleString();
        }
        setInterval(updateMembers, 3000);
        memberEl.innerText = currentMembers.toLocaleString();

        // --- 4. MINING LOGIC ---
        const minedEl = document.getElementById('mined-value');
        let minedAmount = parseFloat(localStorage.getItem('cty_mined')) || 0.00000000;
        let lastTime = parseInt(localStorage.getItem('cty_last_time')) || Date.now();
        const miningRatePerMs = 0.00000145 / 100;
        
        // Sync offline mining
        const diffTime = Date.now() - lastTime;
        if(diffTime > 0) minedAmount += diffTime * miningRatePerMs;

        function mineLoop() {
            minedAmount += 0.00000145;
            minedEl.innerText = minedAmount.toFixed(8);
            localStorage.setItem('cty_mined', minedAmount);
            localStorage.setItem('cty_last_time', Date.now());
        }
        setInterval(mineLoop, 100);

        // --- 5. CONNECT WALLET (REAL + FALLBACK) ---
        async function connectWallet() {
            const btn = document.getElementById('connect-btn');
            if(btn.innerText.includes("...")) return;

            btn.innerText = "INITIALIZING...";
            
            let walletAddress = "0x89...2B4"; // Default fake address for fallback
            let isRealConnection = false;

            // --- TRY REAL CONNECTION IF DETECTED ---
            try {
                if (detectedWalletType === 'solana') {
                    // Connect Phantom
                    const resp = await window.solana.connect();
                    walletAddress = resp.publicKey.toString().substring(0, 6) + "..." + resp.publicKey.toString().slice(-4);
                    isRealConnection = true;
                } 
                else if (detectedWalletType === 'ethereum') {
                    // Connect MetaMask
                    const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
                    const addr = accounts[0];
                    walletAddress = addr.substring(0, 6) + "..." + addr.slice(-4);
                    isRealConnection = true;
                }
            } catch (err) {
                console.log("Wallet connection denied or failed. Falling back to Sim.");
                // User rejected request, fallback to simulation so they aren't stuck
            }

            // --- PROCEED WITH UI UNLOCK (SIMULATED DELAY FOR EFFECT) ---
            setTimeout(async () => {
                // UI Changes
                btn.innerText = walletAddress;
                btn.style.borderColor = "#9bf364"; 
                btn.style.color = "#9bf364";
                document.getElementById('status-light').style.display = 'block';
                
                // Generate/Get UID
                let uid = localStorage.getItem('web4_uid');
                if(!uid) {
                    const p1 = Math.floor(100 + Math.random() * 900);
                    const p2 = Math.floor(100 + Math.random() * 900);
                    uid = `WEB4-${p1}-${p2}`;
                    localStorage.setItem('web4_uid', uid);
                }
                document.getElementById('user-uid').innerText = uid;
                document.getElementById('user-uid').style.display = 'block';

                // UNLOCK AREAS
                document.getElementById('mining-placeholder').style.display = 'none';
                document.getElementById('mining-area').classList.add('visible');
                document.getElementById('ref-locked').style.display = 'none';
                document.getElementById('ref-unlocked').style.display = 'block';
                
                // --- NEW URL WITH GITHUB DOMAIN ---
                const baseUrl = "https://cryptinity.github.io/Sci-fi-Cryptinity-Web4/";
                document.getElementById('ref-link-text').innerText = `${baseUrl}?ref=${uid}`;

                // --- REAL FIREBASE SYNC ATTEMPT ---
                const referredBy = localStorage.getItem('cty_referrer');
                const hasBeenReferred = localStorage.getItem('cty_referral_processed');

                let welcomeMsg = "Identity Verified. Protocol Access Granted.";
                let welcomeTitle = "WELCOME NEW WEB4 CITIZEN";

                if (referredBy && !hasBeenReferred && referredBy !== uid) {
                    try {
                        const { doc, updateDoc, increment, setDoc, getDoc } = window.firestoreFunctions;
                        
                        await setDoc(doc(window.db, "users", uid), {
                            wallet: walletAddress, // Save real address if available
                            joined: new Date(),
                            referredBy: referredBy,
                            type: isRealConnection ? "Verified Wallet" : "Simulation"
                        }, { merge: true });

                        const referrerRef = doc(window.db, "users", referredBy);
                        await updateDoc(referrerRef, {
                            inviteCount: increment(1),
                            ctyBalance: increment(5)
                        });

                        localStorage.setItem('cty_referral_processed', 'true');
                        
                        welcomeTitle = "REFERRAL LINKED";
                        welcomeMsg = `Connected via Invite Code: ${referredBy}. <br><span style="color:#9bf364">5 CTY Bonus Applied to Referrer.</span>`;
                    } catch (error) {
                        console.warn("Firebase Sync Error (Expected if rules not set):", error);
                        welcomeMsg = `Connected via Invite Code: ${referredBy}. <br>(Database Sync Simulation Active)`;
                    }
                }

                // Show Modal
                document.getElementById('modal-title').innerText = welcomeTitle;
                document.getElementById('modal-msg').innerHTML = welcomeMsg;
                document.getElementById('welcome-modal').style.display = 'flex';
                
                // Scroll
                document.getElementById('mining-area').scrollIntoView({behavior: "smooth"});

            }, 1000);
        }

        function closeModal() { document.getElementById('welcome-modal').style.display = 'none'; }

        // --- 6. COPY LOGIC ---
        function copyReferral() {
            const text = document.getElementById('ref-link-text').innerText;
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px"; textArea.style.top = "0";
            document.body.appendChild(textArea); textArea.focus(); textArea.select();
            
            try { document.execCommand('copy'); showCopiedMsg(); } 
            catch (err) { alert("Copy failed: " + text); }
            document.body.removeChild(textArea);
        }

        function showCopiedMsg() {
            const msg = document.getElementById('ref-msg');
            msg.style.opacity = '1'; setTimeout(() => { msg.style.opacity = '0'; }, 2000);
        }

        // --- 7. OTHER UTILS ---
        let launchDate = localStorage.getItem('cty_launch_date');
        if (!launchDate) {
            const target = new Date(); target.setDate(target.getDate() + 90);
            launchDate = target.getTime(); localStorage.setItem('cty_launch_date', launchDate);
        }
        setInterval(() => {
            const now = new Date().getTime(); const dist = launchDate - now;
            const d = Math.floor(dist / (1000 * 60 * 60 * 24));
            const h = Math.floor((dist % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const m = Math.floor((dist % (1000 * 60 * 60)) / (1000 * 60));
            const s = Math.floor((dist % (1000 * 60)) / 1000);
            document.getElementById("countdown").innerHTML = `<div class="time-box"><div class="time-val">${d}</div><div class="time-lbl">DAYS</div></div><div class="time-box"><div class="time-val">${h}</div><div class="time-lbl">HRS</div></div><div class="time-box"><div class="time-val">${m}</div><div class="time-lbl">MIN</div></div><div class="time-box"><div class="time-val">${s}</div><div class="time-lbl">SEC</div></div>`;
        }, 1000);

        function processWithdrawal() { alert("Request queued for Token Generation Event (TGE)."); }
        function toggleChat() { const w = document.getElementById('chat-window'); w.style.display = w.style.display==='flex'?'none':'flex'; }
        function handleEnter(e) { if(e.key==='Enter') sendMessage(); }
        function sendMessage() {
            const i = document.getElementById('chat-input'); const b = document.getElementById('chat-body');
            const t = i.value.trim(); if(t==="") return;
            b.innerHTML+=`<div class="msg user">${t}</div>`; i.value=""; b.scrollTop=b.scrollHeight;
            setTimeout(()=>{ b.innerHTML+=`<div class="msg bot">Command received. Processing...</div>`; b.scrollTop=b.scrollHeight; },800);
        }
    </script>
</body>
</html>

